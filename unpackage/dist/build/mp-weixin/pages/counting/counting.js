(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/counting/counting"],{"2f1d":function(t,e,n){},"393f":function(t,e,n){"use strict";(function(t){n("60b4");i(n("66fd"));var e=i(n("7bab"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n("543d")["createPage"])},"7bab":function(t,e,n){"use strict";n.r(e);var i=n("af2a"),o=n("ec0d");for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);n("f921");var u,c=n("f0c5"),a=Object(c["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],u);e["default"]=a.exports},af2a:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return i}));var i={uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-icon/u-icon")]).then(n.bind(null,"9c86"))}},o=function(){var t=this,e=t.$createElement;t._self._c},r=[]},b9d8:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=c(n("a34a")),o=c(n("7e26")),r=c(n("3c3a")),u=n("26cb");function c(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n,i,o,r,u){try{var c=t[r](u),a=c.value}catch(s){return void n(s)}c.done?e(a):Promise.resolve(a).then(i,o)}function s(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var r=t.apply(e,n);function u(t){a(r,i,o,u,c,"next",t)}function c(t){a(r,i,o,u,c,"throw",t)}u(void 0)}))}}function f(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(Object(n),!0).forEach((function(e){d(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var h={data:function(){return{mapCtx:void 0,longitude:void 0,latitude:void 0,speed:0,timer:void 0,time:0,hasRun:0,running:!1,runTime:0,runningType:"play-left-fill"}},created:function(){var e=this;t.authorize({scope:"scope.userLocation",success:function(t){e.reSetPosition()}})},mounted:function(){this.mapCtx=t.createMapContext("Lmap")},methods:l({getLocation:function(){return s(i.default.mark((function e(){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.getLocation({type:"gcj02",success:function(t){e(t)},fail:function(t){console.log("failed"),n("获取定位失败 ",t)}})})));case 1:case"end":return e.stop()}}),e)})))()},reSetPosition:function(){var t=this;this.getLocation().then((function(e){console.log("position: ",e),t.longitude=e.longitude,t.latitude=e.latitude,t.mapCtx.moveToLocation({longitude:e.longitude,latitude:e.latitude})})).catch((function(t){throw t}))},_locationChangeFn:function(t){var e=(new Date).getTime(),n=(e-this.time)/1e3,i=(t.speed-this.speed)/n;this.hasRun+=t.speed>0?this.speed*n+i*Math.pow(n,2)/2:0,this.speed=t.speed,this.time=e,this.longitude=t.longitude,this.latitude=t.latitude},stopRunning:function(){var e=this,n={mile:this.hasRun,dur:this.runTime,date:r.default.formDate()};t.request({url:o.default+"/recoderun",method:"PUT",data:{id:this.userinfo.id,run:JSON.stringify(n)},success:function(i){var o=i.data;1===o.code?(e.setExerciseAchive(n),t.showToast({title:o.msg,icon:"success"})):t.showToast({title:"服务器故障",icon:"error"})}}),clearInterval(this.timer),this.runTime=0,wx.offLocationChange(this._locationChangeFn),this.runningType="play-left-fill"},getMyPosition:function(){var t=this;if(this.running)return this.stopRunning();this.getLocation().catch((function(t){throw t})).finally((function(){wx.startLocationUpdate({type:"gcj02",success:function(e){t.time=(new Date).getTime(),t.timer=setInterval((function(){t.runTime+=1}),1e3),t.running=!0,t.runningType="pause",wx.onLocationChange(t._locationChangeFn)},fail:function(t){throw t}})}))},formatTime:function(){console.log(this.runTime);var t=Math.floor(this.runTime/60);return t>0&&(this.runTime-=60*t),"".concat(t,":").concat(this.runTime)}},(0,u.mapMutations)(["setExerciseAchive"])),computed:l({formatHasRun:function(){var t=this.hasRun.toFixed(2);return t>0?t:0}},(0,u.mapState)({userinfo:function(t){return t.userinfo}}))};e.default=h}).call(this,n("543d")["default"])},ec0d:function(t,e,n){"use strict";n.r(e);var i=n("b9d8"),o=n.n(i);for(var r in i)"default"!==r&&function(t){n.d(e,t,(function(){return i[t]}))}(r);e["default"]=o.a},f921:function(t,e,n){"use strict";var i=n("2f1d"),o=n.n(i);o.a}},[["393f","common/runtime","common/vendor"]]]);